generator client {
  provider      = "prisma-client-js"
  binaryTargets = ["native", "debian-openssl-3.0.x", "linux-musl", "linux-musl-openssl-3.0.x"]
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Organization {
  id                    String                      @id @default(cuid())
  name                  String
  slug                  String                      @unique
  ownerId               String?
  status                String                      @default("ACTIVE")
  createdAt             DateTime                    @default(now())
  updatedAt             DateTime                    @updatedAt
  impersonationLogs     AdminImpersonationLog[]
  impersonationSessions AdminImpersonationSession[]
  events                Event[]
  products              Product[]
  productCategories     ProductCategory[]
  recipes               Recipe[]
  recipeCategories      RecipeCategory[]
  scheduleSectors       ScheduleSector[]
  suppliers             Supplier[]
  users                 User[]
  costCenters           CostCenter[]
}

model UserCostCenterAccess {
  id             String     @id @default(cuid())
  userId         String
  costCenterId   String
  organizationId String
  createdAt      DateTime   @default(now())
  costCenter     CostCenter @relation(fields: [costCenterId], references: [id], onDelete: Cascade)
  user           User       @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, costCenterId])
  @@index([organizationId])
  @@index([userId])
}

model AdminImpersonationSession {
  id                 String       @id @default(cuid())
  systemMasterUserId String
  organizationId     String
  expiresAt          DateTime
  revokedAt          DateTime?
  metadata           Json?
  createdAt          DateTime     @default(now())
  organization       Organization @relation(fields: [organizationId], references: [id], onDelete: Cascade)

  @@index([systemMasterUserId])
}

model AdminImpersonationLog {
  id                 String       @id @default(cuid())
  systemMasterUserId String
  organizationId     String
  action             String
  metadata           Json?
  timestamp          DateTime     @default(now())
  organization       Organization @relation(fields: [organizationId], references: [id], onDelete: Cascade)

  @@index([organizationId])
  @@index([systemMasterUserId])
}

model User {
  id                         String                  @id @default(cuid())
  email                      String                  @unique
  passwordHash               String
  firstName                  String
  lastName                   String
  phone                      String?
  avatarUrl                  String?
  role                       UserRole                @default(STAFF)
  scope                      UserScope               @default(RESTAURANTS)
  isActive                   Boolean                 @default(true)
  emailVerified              Boolean                 @default(false)
  mfaEnabled                 Boolean                 @default(false)
  mfaSecret                  String?
  organizationId             String?
  costCenterId               String?
  createdAt                  DateTime                @default(now())
  updatedAt                  DateTime                @updatedAt
  lastLoginAt                DateTime?
  achievements               Achievement[]
  alerts                     Alert[]
  auditLogs                  AuditLog[]
  cashMovements              CashMovement[]          @relation("CashMovements")
  cashSessionsClosed         CashSession[]           @relation("CashSessionCloser")
  cashSessionsOpened         CashSession[]           @relation("CashSessionOpener")
  indicatorAccess            IndicatorAccess[]
  indicatorComments          IndicatorComment[]
  pdvOrdersCreated           PdvOrder[]              @relation("PdvOrderCreator")
  statusChanges              PdvOrderStatusHistory[] @relation("StatusChanges")
  operatedBatches            PortioningBatch[]       @relation("BatchOperator")
  purchaseListsCreated       PurchaseList[]          @relation("PurchaseListCreator")
  revenuesCreated            Revenue[]               @relation("RevenueCreator")
  purchaseListItemsConfirmed PurchaseListItem[]      @relation("PurchaseListItemConfirmer")
  sessions                   Session[]
  stockMovements             StockMovement[]
  approvedRequests           StockRequest[]          @relation("ApprovedRequests")
  stockRequests              StockRequest[]          @relation("CreatedRequests")
  requestComments            StockRequestComment[]
  requestTemplates           StockRequestTemplate[]
  costCenter                 CostCenter?             @relation(fields: [costCenterId], references: [id])
  organization               Organization?           @relation(fields: [organizationId], references: [id])
  costCenterAccess           UserCostCenterAccess[]
  ownedIndicators            Indicator[]             @relation("IndicatorOwner")

  @@index([email])
  @@index([costCenterId])
  @@index([organizationId])
}

model Session {
  id           String   @id @default(cuid())
  userId       String
  token        String   @unique
  refreshToken String   @unique
  expiresAt    DateTime
  ipAddress    String?
  userAgent    String?
  createdAt    DateTime @default(now())
  user         User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([token])
}

model CostCenter {
  id                    String                 @id @default(cuid())
  organizationId        String?
  name                  String
  tradeName             String?
  cnpj                  String?                @unique
  email                 String?
  phone                 String?
  logoUrl               String?
  street                String?
  number                String?
  complement            String?
  neighborhood          String?
  city                  String?
  state                 String?
  zipCode               String?
  country               String                 @default("BR")
  timezone              String                 @default("America/Sao_Paulo")
  currency              String                 @default("BRL")
  locale                String                 @default("pt-BR")
  targetCmvPercent      Float                  @default(30.0)
  alertCmvThreshold     Float                  @default(35.0)
  plan                  String                 @default("free")
  planExpiresAt         DateTime?
  primaryColor          String                 @default("#6366f1")
  secondaryColor        String                 @default("#8b5cf6")
  customDomain          String?
  isActive              Boolean                @default(true)
  createdAt             DateTime               @default(now())
  updatedAt             DateTime               @updatedAt
  alerts                Alert[]
  alertRules            AlertRule[]
  cmvSnapshots          CMVSnapshot[]
  cashSessions          CashSession[]
  consumptionAnomalies  ConsumptionAnomaly[]
  customers             Customer[]
  integrations          Integration[]
  inventorySessions     InventorySession[]
  menuAnalyses          MenuAnalysis[]
  menuCategories        MenuCategory[]
  orders                Order[]
  pdvOrders             PdvOrder[]             @relation("PdvOrders")
  portioningProcesses   PortioningProcess[]
  purchaseConfig        PurchaseConfig?
  purchaseLists         PurchaseList[]
  purchaseSuggestions   PurchaseSuggestion[]
  tables                RestaurantTable[]
  stockRequests         StockRequest[]
  stockRequestTemplates StockRequestTemplate[]
  users                 User[]
  userAccess            UserCostCenterAccess[]
  organization          Organization?          @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  indicators            Indicator[]
  revenues              Revenue[]

  @@index([cnpj])
  @@index([organizationId])
  @@map("cost_centers")
}

model Order {
  id                     String     @id @default(cuid())
  costCenterId           String
  organizationId         String?
  externalId             String
  logisticsProvider      String
  integrationId          String?
  orderDatetime          DateTime
  readyDatetime          DateTime?
  outForDeliveryDatetime DateTime?
  deliveredDatetime      DateTime?
  prepTime               Float?
  pickupTime             Float?
  deliveryTime           Float?
  totalTime              Float?
  customerName           String?
  deliveryAddress        String?
  orderValue             Float?
  metadata               Json?
  createdAt              DateTime   @default(now())
  updatedAt              DateTime   @updatedAt
  costCenter             CostCenter @relation(fields: [costCenterId], references: [id], onDelete: Cascade)

  @@unique([costCenterId, externalId, logisticsProvider])
  @@index([costCenterId])
  @@index([organizationId])
  @@index([orderDatetime])
  @@index([logisticsProvider])
}

model Integration {
  id                   String              @id @default(cuid())
  costCenterId         String
  organizationId       String?
  platform             IntegrationPlatform
  name                 String
  status               IntegrationStatus   @default(CONFIGURED)
  credentials          Json?
  accessToken          String?
  refreshToken         String?
  tokenExpiresAt       DateTime?
  syncFrequencyMinutes Int                 @default(15)
  lastSyncAt           DateTime?
  nextSyncAt           DateTime?
  fieldMapping         Json?
  webhookUrl           String?
  webhookSecret        String?
  externalId           String?
  metadata             Json?
  createdAt            DateTime            @default(now())
  updatedAt            DateTime            @updatedAt
  costCenter           CostCenter          @relation(fields: [costCenterId], references: [id], onDelete: Cascade)
  inboxItems           IntegrationInbox[]
  syncLogs             SyncLog[]

  @@unique([costCenterId, platform, externalId])
  @@index([costCenterId])
  @@index([status])
  @@index([organizationId])
}

model SyncLog {
  id               String      @id @default(cuid())
  integrationId    String
  syncType         SyncType
  status           SyncStatus  @default(PENDING)
  recordsProcessed Int         @default(0)
  recordsCreated   Int         @default(0)
  recordsUpdated   Int         @default(0)
  recordsFailed    Int         @default(0)
  errors           Json?
  metadata         Json?
  startedAt        DateTime    @default(now())
  completedAt      DateTime?
  integration      Integration @relation(fields: [integrationId], references: [id], onDelete: Cascade)

  @@index([integrationId])
  @@index([status])
  @@index([startedAt])
}

model IntegrationInbox {
  id            String      @id @default(cuid())
  integrationId String
  externalId    String?
  correlationId String?
  source        String
  event         String?
  rawPayload    Json
  parsedPayload Json?
  status        InboxStatus @default(PENDING)
  errorMessage  String?
  retriesCount  Int         @default(0)
  receivedAt    DateTime    @default(now())
  processedAt   DateTime?
  integration   Integration @relation(fields: [integrationId], references: [id], onDelete: Cascade)

  @@index([integrationId])
  @@index([status])
  @@index([externalId])
  @@index([correlationId])
}

model WorkTimeOrder {
  id              String    @id @default(cuid())
  restaurantId    String
  provider        String
  providerOrderId String
  orderDate       DateTime
  arrivedAt       DateTime
  readyAt         DateTime?
  pickedUpAt      DateTime?
  deliveredAt     DateTime?
  shift           String
  workday         DateTime  @db.Date
  rawPayload      Json?
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt

  @@unique([restaurantId, provider, providerOrderId])
  @@index([restaurantId, workday, shift])
  @@index([provider, orderDate])
}

model ProductCategory {
  id             String            @id @default(cuid())
  name           String
  description    String?
  parentId       String?
  sortOrder      Int               @default(0)
  isActive       Boolean           @default(true)
  createdAt      DateTime          @default(now())
  updatedAt      DateTime          @updatedAt
  organizationId String?
  products       Product[]
  organization   Organization?     @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  parent         ProductCategory?  @relation("CategoryHierarchy", fields: [parentId], references: [id])
  children       ProductCategory[] @relation("CategoryHierarchy")
  recipes        Recipe[]

  @@unique([organizationId, name, parentId])
  @@index([organizationId])
}

model Product {
  id                        String                     @id @default(cuid())
  organizationId            String?
  sku                       String?
  barcode                   String?
  name                      String
  description               String?
  categoryId                String?
  baseUnit                  String                     @default("un")
  unitType                  UnitType                   @default(UNIT)
  conversions               Json?
  currentStock              Float                      @default(0)
  reorderPoint              Float?
  manualReorderPoint        Float?
  avgCost                   Float                      @default(0)
  lastPurchasePrice         Float                      @default(0)
  lastPurchaseDate          DateTime?
  isPerishable              Boolean                    @default(false)
  shelfLifeDays             Int?
  defaultSupplierId         String?
  leadTimeDays              Int                        @default(1)
  isActive                  Boolean                    @default(true)
  isRawMaterial             Boolean                    @default(true)
  externalId                String?
  imageUrl                  String?
  createdAt                 DateTime                   @default(now())
  updatedAt                 DateTime                   @updatedAt
  consumptionAnomalies      ConsumptionAnomaly[]
  inventoryItems            InventoryItem[]
  portioningAsOutput        PortioningProcess[]        @relation("OutputProduct")
  portioningAsRaw           PortioningProcess[]        @relation("RawProduct")
  category                  ProductCategory?           @relation(fields: [categoryId], references: [id])
  defaultSupplier           Supplier?                  @relation(fields: [defaultSupplierId], references: [id])
  organization              Organization?              @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  purchaseListItems         PurchaseListItem[]
  purchaseSuggestions       PurchaseSuggestion[]
  recipesAsOutput           Recipe[]                   @relation("RecipeOutput")
  recipeIngredients         RecipeIngredient[]
  stockBatches              StockBatch[]
  movements                 StockMovement[]
  stockRequestItems         StockRequestItem[]
  stockRequestTemplateItems StockRequestTemplateItem[]

  @@unique([organizationId, sku])
  @@unique([organizationId, barcode])
  @@index([organizationId])
  @@index([categoryId])
  @@index([name])
}

model Supplier {
  id                String            @id @default(cuid())
  organizationId    String?
  name              String
  tradeName         String?
  cnpj              String?
  email             String?
  phone             String?
  whatsapp          String?
  street            String?
  city              String?
  state             String?
  zipCode           String?
  paymentTerms      String?
  rating            Float?
  notes             String?
  isActive          Boolean           @default(true)
  createdAt         DateTime          @default(now())
  updatedAt         DateTime          @updatedAt
  portioningBatches PortioningBatch[] @relation("BatchSupplier")
  products          Product[]
  movements         StockMovement[]
  organization      Organization?     @relation(fields: [organizationId], references: [id], onDelete: Cascade)

  @@index([organizationId])
}

model StockMovement {
  id             String                 @id @default(cuid())
  productId      String
  type           MovementType
  quantity       Float
  unit           String
  costPerUnit    Float                  @default(0)
  totalCost      Float                  @default(0)
  stockBefore    Float                  @default(0)
  stockAfter     Float                  @default(0)
  referenceType  MovementReferenceType?
  referenceId    String?
  supplierId     String?
  invoiceNumber  String?
  batchId        String?
  notes          String?
  userId         String?
  createdAt      DateTime               @default(now())
  organizationId String?
  batch          StockBatch?            @relation(fields: [batchId], references: [id])
  product        Product                @relation(fields: [productId], references: [id], onDelete: Cascade)
  supplier       Supplier?              @relation(fields: [supplierId], references: [id])
  user           User?                  @relation(fields: [userId], references: [id])

  @@index([productId])
  @@index([type])
  @@index([createdAt])
  @@index([referenceType, referenceId])
  @@index([organizationId])
}

model StockBatch {
  id              String          @id @default(cuid())
  productId       String
  batchNumber     String
  quantity        Float
  remainingQty    Float
  costPerUnit     Float
  manufactureDate DateTime?
  expirationDate  DateTime?
  createdAt       DateTime        @default(now())
  organizationId  String?
  product         Product         @relation(fields: [productId], references: [id], onDelete: Cascade)
  movements       StockMovement[]

  @@index([productId])
  @@index([expirationDate])
  @@index([organizationId])
}

model RecipeCategory {
  id             String        @id @default(cuid())
  name           String
  createdAt      DateTime      @default(now())
  updatedAt      DateTime      @updatedAt
  organizationId String?
  recipes        Recipe[]
  organization   Organization? @relation(fields: [organizationId], references: [id], onDelete: Cascade)

  @@unique([organizationId, name])
  @@index([organizationId])
}

model Recipe {
  id                 String              @id @default(cuid())
  organizationId     String?
  name               String
  description        String?
  type               RecipeType          @default(FINAL_PRODUCT)
  status             RecipeStatus        @default(DRAFT)
  recipeCategoryId   String?
  productCategoryId  String?
  outputProductId    String?
  yieldQuantity      Float               @default(1)
  yieldUnit          String              @default("un")
  currentCost        Float               @default(0)
  costPerUnit        Float               @default(0)
  costHistory        Json?
  targetCmv          Float?
  suggestedPrice     Float?
  currentPrice       Float?
  packagingCost      Float               @default(0)
  laborCost          Float               @default(0)
  overheadPercent    Float               @default(0)
  prepTimeMinutes    Int?
  cookTimeMinutes    Int?
  version            Int                 @default(1)
  isActive           Boolean             @default(true)
  imageUrl           String?
  instructions       String?
  externalId         String?
  createdAt          DateTime            @default(now())
  updatedAt          DateTime            @updatedAt
  itemPerformances   ItemPerformance[]
  menuItems          MenuItem[]
  pricingSuggestions PricingSuggestion[]
  organization       Organization?       @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  outputProduct      Product?            @relation("RecipeOutput", fields: [outputProductId], references: [id])
  productCategory    ProductCategory?    @relation(fields: [productCategoryId], references: [id])
  recipeCategory     RecipeCategory?     @relation(fields: [recipeCategoryId], references: [id])
  ingredients        RecipeIngredient[]
  usedAsIngredient   RecipeIngredient[]  @relation("SubRecipe")

  @@index([recipeCategoryId])
  @@index([name])
  @@index([organizationId])
}

model RecipeIngredient {
  id             String         @id @default(cuid())
  recipeId       String
  ingredientType IngredientType
  productId      String?
  subRecipeId    String?
  quantity       Float
  unit           String
  costSnapshot   Float          @default(0)
  notes          String?
  isOptional     Boolean        @default(false)
  createdAt      DateTime       @default(now())
  updatedAt      DateTime       @updatedAt
  product        Product?       @relation(fields: [productId], references: [id], onDelete: Cascade)
  recipe         Recipe         @relation(fields: [recipeId], references: [id], onDelete: Cascade)
  subRecipe      Recipe?        @relation("SubRecipe", fields: [subRecipeId], references: [id])

  @@index([recipeId])
  @@index([productId])
  @@index([subRecipeId])
}

model PricingSuggestion {
  id              String       @id @default(cuid())
  recipeId        String
  channel         SalesChannel
  recipeCost      Float
  packagingCost   Float        @default(0)
  deliveryFee     Float        @default(0)
  platformFee     Float        @default(0)
  suggestedPrice  Float
  currentPrice    Float?
  competitorPrice Float?
  markupPercent   Float
  marginPercent   Float
  marginAmount    Float
  generatedAt     DateTime     @default(now())
  recipe          Recipe       @relation(fields: [recipeId], references: [id], onDelete: Cascade)

  @@index([recipeId])
  @@index([channel])
}

model PortioningProcess {
  id              String                    @id @default(cuid())
  costCenterId    String
  name            String
  description     String?
  rawProductId    String
  outputProductId String?
  yieldPercent    Float                     @default(100)
  wastePercent    Float                     @default(0)
  laborCost       Float                     @default(0)
  energyCost      Float                     @default(0)
  yieldStdDev     Float?
  isActive        Boolean                   @default(true)
  createdAt       DateTime                  @default(now())
  updatedAt       DateTime                  @updatedAt
  organizationId  String?
  batches         PortioningBatch[]
  costCenter      CostCenter                @relation(fields: [costCenterId], references: [id], onDelete: Cascade)
  outputProduct   Product?                  @relation("OutputProduct", fields: [outputProductId], references: [id])
  rawProduct      Product                   @relation("RawProduct", fields: [rawProductId], references: [id], onDelete: Cascade)
  outputs         PortioningProcessOutput[]

  @@index([costCenterId])
  @@index([organizationId])
}

model PortioningProcessOutput {
  id                String            @id @default(cuid())
  processId         String
  name              String
  isActive          Boolean           @default(true)
  useStandardWeight Boolean           @default(false)
  standardWeight    Float?
  unit              String            @default("g")
  createdAt         DateTime          @default(now())
  updatedAt         DateTime          @updatedAt
  process           PortioningProcess @relation(fields: [processId], references: [id], onDelete: Cascade)

  @@index([processId])
}

model PortioningBatch {
  id             String                  @id @default(cuid())
  processId      String
  accuracy       Float
  costCenterId   String?
  createdAt      DateTime                @default(now())
  finalWeight    Float
  initialUnit    String                  @default("kg")
  initialWeight  Float
  operatorId     String
  organizationId String?
  percentYield   Float
  portionCount   Int?
  portionWeight  Float?
  supplierId     String?
  updatedAt      DateTime                @updatedAt
  operator       User                    @relation("BatchOperator", fields: [operatorId], references: [id])
  process        PortioningProcess       @relation(fields: [processId], references: [id], onDelete: Cascade)
  supplier       Supplier?               @relation("BatchSupplier", fields: [supplierId], references: [id])
  outputs        PortioningBatchOutput[]

  @@index([processId])
  @@index([operatorId])
  @@index([supplierId])
  @@index([createdAt])
}

model PortioningBatchOutput {
  id           String          @id @default(cuid())
  batchId      String
  name         String
  actualWeight Float
  unit         String          @default("g")
  createdAt    DateTime        @default(now())
  batch        PortioningBatch @relation(fields: [batchId], references: [id], onDelete: Cascade)

  @@index([batchId])
}

model CMVSnapshot {
  id                 String     @id @default(cuid())
  costCenterId       String
  date               DateTime   @db.Date
  revenue            Float      @default(0)
  orderCount         Int        @default(0)
  avgTicket          Float      @default(0)
  theoreticalCogs    Float      @default(0)
  realCogs           Float      @default(0)
  theoreticalPercent Float      @default(0)
  realPercent        Float      @default(0)
  wastePercent       Float      @default(0)
  wasteAmount        Float      @default(0)
  byCategory         Json?
  byChannel          Json?
  createdAt          DateTime   @default(now())
  updatedAt          DateTime   @updatedAt
  costCenter         CostCenter @relation(fields: [costCenterId], references: [id], onDelete: Cascade)

  @@unique([costCenterId, date])
  @@index([costCenterId])
  @@index([date])
}

model MenuAnalysis {
  id                     String            @id @default(cuid())
  costCenterId           String
  periodStart            DateTime
  periodEnd              DateTime
  totalRevenue           Float             @default(0)
  totalItemsSold         Int               @default(0)
  totalCost              Float             @default(0)
  popularityThreshold    Float             @default(0.7)
  profitabilityThreshold Float             @default(0.7)
  createdAt              DateTime          @default(now())
  items                  ItemPerformance[]
  costCenter             CostCenter        @relation(fields: [costCenterId], references: [id], onDelete: Cascade)

  @@index([costCenterId])
  @@index([periodStart, periodEnd])
}

model ItemPerformance {
  id                   String                @id @default(cuid())
  analysisId           String
  recipeId             String
  quantitySold         Int                   @default(0)
  revenue              Float                 @default(0)
  cost                 Float                 @default(0)
  marginAmount         Float                 @default(0)
  marginPercent        Float                 @default(0)
  popularityScore      Float                 @default(0)
  profitabilityScore   Float                 @default(0)
  abcClassification    ABCClassification?
  matrixClassification MatrixClassification?
  recommendedAction    RecommendedAction?
  actionReasonning     String?
  analysis             MenuAnalysis          @relation(fields: [analysisId], references: [id], onDelete: Cascade)
  recipe               Recipe                @relation(fields: [recipeId], references: [id], onDelete: Cascade)

  @@index([analysisId])
  @@index([recipeId])
}

model Alert {
  id           String        @id @default(cuid())
  costCenterId String
  type         AlertType
  severity     AlertSeverity @default(MEDIUM)
  title        String
  message      String
  data         Json?
  actionUrl    String?
  isRead       Boolean       @default(false)
  readAt       DateTime?
  readById     String?
  createdAt    DateTime      @default(now())
  expiresAt    DateTime?
  costCenter   CostCenter    @relation(fields: [costCenterId], references: [id], onDelete: Cascade)
  readBy       User?         @relation(fields: [readById], references: [id])

  @@index([costCenterId])
  @@index([type])
  @@index([isRead])
  @@index([createdAt])
}

model AlertRule {
  id                   String                @id @default(cuid())
  costCenterId         String
  type                 AlertType
  name                 String
  conditions           Json
  notificationChannels NotificationChannel[]
  isActive             Boolean               @default(true)
  createdAt            DateTime              @default(now())
  updatedAt            DateTime              @updatedAt
  costCenter           CostCenter            @relation(fields: [costCenterId], references: [id], onDelete: Cascade)

  @@index([costCenterId])
  @@index([type])
}

model PurchaseSuggestion {
  id                  String             @id @default(cuid())
  costCenterId        String
  productId           String
  currentStock        Float
  avgDailyConsumption Float
  suggestedQuantity   Float
  suggestedUnit       String
  reorderPoint        Float
  leadTimeDays        Int
  estimatedRunoutDate DateTime?
  priority            SuggestionPriority @default(MEDIUM)
  reasoning           String?
  confidence          Float              @default(0.5)
  isAccepted          Boolean?
  acceptedAt          DateTime?
  acceptedQuantity    Float?
  generatedAt         DateTime           @default(now())
  expiresAt           DateTime?
  costCenter          CostCenter         @relation(fields: [costCenterId], references: [id], onDelete: Cascade)
  product             Product            @relation(fields: [productId], references: [id], onDelete: Cascade)

  @@index([costCenterId])
  @@index([productId])
  @@index([priority])
}

model ConsumptionAnomaly {
  id               String        @id @default(cuid())
  costCenterId     String
  productId        String
  anomalyType      AnomalyType
  severity         AlertSeverity @default(MEDIUM)
  expectedValue    Float
  actualValue      Float
  deviationPercent Float
  aiAnalysis       String?
  suggestedAction  String?
  periodStart      DateTime
  periodEnd        DateTime
  isResolved       Boolean       @default(false)
  resolvedAt       DateTime?
  resolution       String?
  detectedAt       DateTime      @default(now())
  costCenter       CostCenter    @relation(fields: [costCenterId], references: [id], onDelete: Cascade)
  product          Product       @relation(fields: [productId], references: [id], onDelete: Cascade)

  @@index([costCenterId])
  @@index([productId])
  @@index([anomalyType])
}

model Indicator {
  id           String             @id @default(cuid())
  costCenterId String
  ownerId      String?
  type         GoalType
  name         String
  description  String?
  targetValue  Float
  currentValue Float              @default(0)
  cycle        IndicatorCycle     @default(MONTHLY)
  periodStart  DateTime
  periodEnd    DateTime
  isDeveloping Boolean            @default(false)
  rewardType   String?
  rewardValue  String?
  rewardPoints Int                @default(0)
  isActive     Boolean            @default(true)
  achievedAt   DateTime?
  createdAt    DateTime           @default(now())
  updatedAt    DateTime           @updatedAt
  access       IndicatorAccess[]
  comments     IndicatorComment[]
  results      IndicatorResult[]
  costCenter   CostCenter         @relation(fields: [costCenterId], references: [id], onDelete: Cascade)
  owner        User?              @relation("IndicatorOwner", fields: [ownerId], references: [id])

  @@index([costCenterId])
  @@index([ownerId])
  @@index([periodStart, periodEnd])
  @@map("goals")
}

model IndicatorResult {
  id             String    @id @default(cuid())
  indicatorId    String
  value          Float
  targetSnapshot Float?
  date           DateTime  @default(now())
  createdAt      DateTime  @default(now())
  indicator      Indicator @relation(fields: [indicatorId], references: [id], onDelete: Cascade)

  @@index([indicatorId])
  @@index([date])
}

model IndicatorAccess {
  id          String    @id @default(cuid())
  indicatorId String
  userId      String
  createdAt   DateTime  @default(now())
  indicator   Indicator @relation(fields: [indicatorId], references: [id], onDelete: Cascade)
  user        User      @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([indicatorId, userId])
  @@index([indicatorId])
  @@index([userId])
}

model IndicatorComment {
  id          String    @id @default(cuid())
  indicatorId String
  userId      String
  message     String
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  indicator   Indicator @relation(fields: [indicatorId], references: [id], onDelete: Cascade)
  user        User      @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([indicatorId])
  @@index([userId])
}

model Achievement {
  id            String        @id @default(cuid())
  userId        String
  badgeName     String
  badgeCategory BadgeCategory
  description   String
  iconUrl       String?
  pointsAwarded Int           @default(0)
  earnedAt      DateTime      @default(now())
  user          User          @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([badgeCategory])
}

model AuditLog {
  id         String      @id @default(cuid())
  userId     String?
  action     AuditAction
  entityType String
  entityId   String?
  oldValues  Json?
  newValues  Json?
  ipAddress  String?
  userAgent  String?
  createdAt  DateTime    @default(now())
  user       User?       @relation(fields: [userId], references: [id])

  @@index([userId])
  @@index([entityType, entityId])
  @@index([createdAt])
}

model InventorySession {
  id           String          @id @default(cuid())
  costCenterId String
  status       InventoryStatus @default(OPEN)
  startDate    DateTime        @default(now())
  endDate      DateTime?
  precision    Float?
  itemsCount   Int             @default(0)
  itemsCorrect Int             @default(0)
  notes        String?
  createdBy    String?
  shareToken   String?         @unique
  createdAt    DateTime        @default(now())
  updatedAt    DateTime        @updatedAt
  items        InventoryItem[]
  costCenter   CostCenter      @relation(fields: [costCenterId], references: [id], onDelete: Cascade)

  @@index([costCenterId])
}

model InventoryItem {
  id                 String           @id @default(cuid())
  inventorySessionId String
  productId          String
  productName        String?
  categoryName       String?
  unit               String?
  costPerUnit        Float?
  expectedQuantity   Float
  countedQuantity    Float?
  difference         Float?
  isCorrect          Boolean          @default(false)
  countedAt          DateTime?
  createdAt          DateTime         @default(now())
  updatedAt          DateTime         @updatedAt
  inventorySession   InventorySession @relation(fields: [inventorySessionId], references: [id], onDelete: Cascade)
  product            Product          @relation(fields: [productId], references: [id], onDelete: Cascade)

  @@unique([inventorySessionId, productId])
  @@index([inventorySessionId])
}

model StockRequest {
  id               String                @id @default(cuid())
  code             String
  costCenterId     String
  shift            WorkShift             @default(DAY)
  createdByUserId  String
  status           StockRequestStatus    @default(PENDING)
  chefObservation  String?
  approvedAt       DateTime?
  approvedByUserId String?
  createdAt        DateTime              @default(now())
  updatedAt        DateTime              @updatedAt
  organizationId   String?
  approvedBy       User?                 @relation("ApprovedRequests", fields: [approvedByUserId], references: [id])
  costCenter       CostCenter            @relation(fields: [costCenterId], references: [id], onDelete: Cascade)
  createdBy        User                  @relation("CreatedRequests", fields: [createdByUserId], references: [id], onDelete: Cascade)
  comments         StockRequestComment[]
  items            StockRequestItem[]

  @@unique([costCenterId, code])
  @@index([costCenterId])
  @@index([createdByUserId])
  @@index([status])
  @@index([organizationId])
}

model StockRequestItem {
  id                  String       @id @default(cuid())
  stockRequestId      String
  productId           String
  productNameSnapshot String
  unitSnapshot        String
  quantityRequested   Float
  quantityApproved    Float?
  notes               String?
  createdAt           DateTime     @default(now())
  product             Product      @relation(fields: [productId], references: [id], onDelete: Cascade)
  stockRequest        StockRequest @relation(fields: [stockRequestId], references: [id], onDelete: Cascade)

  @@index([stockRequestId])
  @@index([productId])
}

model StockRequestComment {
  id             String       @id @default(cuid())
  stockRequestId String
  userId         String
  message        String
  createdAt      DateTime     @default(now())
  stockRequest   StockRequest @relation(fields: [stockRequestId], references: [id], onDelete: Cascade)
  user           User         @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([stockRequestId])
}

model StockRequestTemplate {
  id              String                     @id @default(cuid())
  costCenterId    String
  name            String?
  createdByUserId String
  createdAt       DateTime                   @default(now())
  updatedAt       DateTime                   @updatedAt
  organizationId  String?
  costCenter      CostCenter                 @relation(fields: [costCenterId], references: [id], onDelete: Cascade)
  createdBy       User                       @relation(fields: [createdByUserId], references: [id], onDelete: Cascade)
  items           StockRequestTemplateItem[]

  @@index([costCenterId])
  @@index([createdByUserId])
  @@index([organizationId])
}

model StockRequestTemplateItem {
  id               String               @id @default(cuid())
  templateId       String
  productId        String
  standardQuantity Float                @default(0)
  product          Product              @relation(fields: [productId], references: [id], onDelete: Cascade)
  template         StockRequestTemplate @relation(fields: [templateId], references: [id], onDelete: Cascade)

  @@unique([templateId, productId])
}

model CashSession {
  id               String            @id @default(cuid())
  costCenterId     String
  status           CashSessionStatus @default(ABERTO)
  openedAt         DateTime          @default(now())
  closedAt         DateTime?
  openedByUserId   String
  closedByUserId   String?
  initialCash      Float             @default(0)
  finalCash        Float?
  totalSales       Float             @default(0)
  totalWithdrawals Float             @default(0)
  totalSupplies    Float             @default(0)
  totalAdjustments Float             @default(0)
  notes            String?
  createdAt        DateTime          @default(now())
  updatedAt        DateTime          @updatedAt
  organizationId   String?
  movements        CashMovement[]
  closedBy         User?             @relation("CashSessionCloser", fields: [closedByUserId], references: [id])
  costCenter       CostCenter        @relation(fields: [costCenterId], references: [id], onDelete: Cascade)
  openedBy         User              @relation("CashSessionOpener", fields: [openedByUserId], references: [id], onDelete: Cascade)
  orders           PdvOrder[]

  @@index([costCenterId])
  @@index([openedByUserId])
  @@index([closedByUserId])
  @@index([status])
  @@index([organizationId])
}

model CashMovement {
  id              String           @id @default(cuid())
  cashSessionId   String
  type            CashMovementType
  amount          Float
  description     String?
  createdByUserId String?
  createdAt       DateTime         @default(now())
  cashSession     CashSession      @relation(fields: [cashSessionId], references: [id], onDelete: Cascade)
  createdBy       User?            @relation("CashMovements", fields: [createdByUserId], references: [id])

  @@index([cashSessionId])
  @@index([type])
  @@index([createdByUserId])
}

model Customer {
  id             String            @id @default(cuid())
  costCenterId   String
  name           String
  phone          String?
  email          String?
  cpf            String?
  notes          String?
  isActive       Boolean           @default(true)
  createdAt      DateTime          @default(now())
  updatedAt      DateTime          @updatedAt
  organizationId String?
  costCenter     CostCenter        @relation(fields: [costCenterId], references: [id], onDelete: Cascade)
  addresses      CustomerAddress[]
  orders         PdvOrder[]

  @@index([costCenterId])
  @@index([organizationId])
  @@index([phone])
  @@index([name])
}

model CustomerAddress {
  id           String     @id @default(cuid())
  customerId   String
  label        String?
  street       String
  number       String?
  complement   String?
  neighborhood String
  city         String
  state        String
  zipCode      String
  reference    String?
  isDefault    Boolean    @default(false)
  createdAt    DateTime   @default(now())
  updatedAt    DateTime   @updatedAt
  customer     Customer   @relation(fields: [customerId], references: [id], onDelete: Cascade)
  orders       PdvOrder[]

  @@index([customerId])
}

model RestaurantTable {
  id             String      @id @default(cuid())
  costCenterId   String
  identifier     String
  capacity       Int         @default(4)
  status         TableStatus @default(LIVRE)
  currentOrderId String?
  isActive       Boolean     @default(true)
  createdAt      DateTime    @default(now())
  updatedAt      DateTime    @updatedAt
  orders         PdvOrder[]
  costCenter     CostCenter  @relation(fields: [costCenterId], references: [id], onDelete: Cascade)

  @@unique([costCenterId, identifier])
  @@index([costCenterId])
  @@index([status])
}

model PdvOrder {
  id                  String                  @id @default(cuid())
  code                String
  costCenterId        String
  orderType           PdvOrderType
  status              PdvOrderStatus          @default(NOVO)
  salesChannel        PdvSalesChannel         @default(PRESENCIAL)
  customerId          String?
  customerName        String?
  customerPhone       String?
  addressId           String?
  deliveryAddressText String?
  deliveryFee         Float                   @default(0)
  tableId             String?
  tableIdentifier     String?
  serviceFee          Float                   @default(0)
  serviceFeePercent   Float                   @default(0)
  subtotal            Float                   @default(0)
  discount            Float                   @default(0)
  discountReason      String?
  total               Float                   @default(0)
  totalPaid           Float                   @default(0)
  changeAmount        Float                   @default(0)
  notes               String?
  kitchenNotes        String?
  estimatedReadyAt    DateTime?
  readyAt             DateTime?
  deliveredAt         DateTime?
  createdByUserId     String?
  createdAt           DateTime                @default(now())
  updatedAt           DateTime                @updatedAt
  cashSessionId       String?
  organizationId      String?
  address             CustomerAddress?        @relation(fields: [addressId], references: [id])
  cashSession         CashSession?            @relation(fields: [cashSessionId], references: [id])
  costCenter          CostCenter              @relation("PdvOrders", fields: [costCenterId], references: [id], onDelete: Cascade)
  createdBy           User?                   @relation("PdvOrderCreator", fields: [createdByUserId], references: [id])
  customer            Customer?               @relation(fields: [customerId], references: [id])
  table               RestaurantTable?        @relation(fields: [tableId], references: [id])
  items               PdvOrderItem[]
  statusHistory       PdvOrderStatusHistory[]
  payments            PdvPayment[]

  @@unique([costCenterId, code])
  @@index([costCenterId])
  @@index([status])
  @@index([orderType])
  @@index([createdAt])
  @@index([customerId])
  @@index([cashSessionId])
  @@index([organizationId])
}

model PdvOrderItem {
  id               String   @id @default(cuid())
  orderId          String
  productId        String?
  recipeId         String?
  productName      String
  productSku       String?
  quantity         Float    @default(1)
  unit             String   @default("un")
  unitPrice        Float
  totalPrice       Float
  notes            String?
  additionals      Json?
  additionalsTotal Float    @default(0)
  isPrinted        Boolean  @default(false)
  isCancelled      Boolean  @default(false)
  cancelReason     String?
  createdAt        DateTime @default(now())
  updatedAt        DateTime @updatedAt
  order            PdvOrder @relation(fields: [orderId], references: [id], onDelete: Cascade)

  @@index([orderId])
  @@index([productId])
}

model PdvOrderStatusHistory {
  id          String          @id @default(cuid())
  orderId     String
  fromStatus  PdvOrderStatus?
  toStatus    PdvOrderStatus
  notes       String?
  changedById String?
  createdAt   DateTime        @default(now())
  changedBy   User?           @relation("StatusChanges", fields: [changedById], references: [id])
  order       PdvOrder        @relation(fields: [orderId], references: [id], onDelete: Cascade)

  @@index([orderId])
  @@index([createdAt])
}

model PdvPayment {
  id                String        @id @default(cuid())
  orderId           String
  method            PaymentMethod
  status            PaymentStatus @default(PENDENTE)
  amount            Float
  receivedAmount    Float?
  changeAmount      Float         @default(0)
  cardBrand         String?
  cardLastDigits    String?
  authorizationCode String?
  cashMovementId    String?
  notes             String?
  processedAt       DateTime?
  createdAt         DateTime      @default(now())
  order             PdvOrder      @relation(fields: [orderId], references: [id], onDelete: Cascade)

  @@index([orderId])
  @@index([method])
}

model PurchaseList {
  id             String                  @id @default(cuid())
  costCenterId   String
  triggerType    PurchaseListTriggerType
  description    String?
  notes          String?
  status         PurchaseListStatus      @default(ABERTA)
  createdById    String
  organizationId String?
  createdAt      DateTime                @default(now())
  updatedAt      DateTime                @updatedAt
  completedAt    DateTime?
  costCenter     CostCenter              @relation(fields: [costCenterId], references: [id], onDelete: Cascade)
  createdBy      User                    @relation("PurchaseListCreator", fields: [createdById], references: [id])
  items          PurchaseListItem[]

  @@index([organizationId])
  @@index([costCenterId])
  @@index([status])
  @@index([createdAt])
}

model PurchaseListItem {
  id                   String                 @id @default(cuid())
  purchaseListId       String
  productId            String
  productNameSnapshot  String
  unitSnapshot         String
  reorderPointSnapshot Float
  currentStockSnapshot Float
  suggestedQuantity    Float
  confirmedQuantity    Float?
  status               PurchaseListItemStatus @default(PENDENTE)
  confirmedAt          DateTime?
  confirmedById        String?
  createdAt            DateTime               @default(now())
  updatedAt            DateTime               @updatedAt
  confirmedBy          User?                  @relation("PurchaseListItemConfirmer", fields: [confirmedById], references: [id])
  product              Product                @relation(fields: [productId], references: [id])
  purchaseList         PurchaseList           @relation(fields: [purchaseListId], references: [id], onDelete: Cascade)

  @@index([purchaseListId])
  @@index([productId])
  @@index([status])
}

model PurchaseConfig {
  id                      String             @id @default(cuid())
  costCenterId            String             @unique
  triggerPostInventory    Boolean            @default(false)
  triggerCriticalStock    Boolean            @default(false)
  criticalStockPercentage Float              @default(20)
  triggerFixedDates       Boolean            @default(false)
  recurrenceType          RecurrenceType     @default(NENHUM)
  weekDays                Int[]              @default([])
  monthDays               Int[]              @default([])
  filterMode              PurchaseFilterMode @default(ALL)
  filterSupplierIds       String[]           @default([])
  filterCategoryIds       String[]           @default([])
  createdAt               DateTime           @default(now())
  updatedAt               DateTime           @updatedAt
  costCenter              CostCenter         @relation(fields: [costCenterId], references: [id], onDelete: Cascade)
}

model Event {
  id             String       @id @default(cuid())
  organizationId String
  name           String
  slug           String
  description    String?
  bannerUrl      String?
  status         EventStatus  @default(DRAFT)
  startsAt       DateTime
  endsAt         DateTime?
  city           String?
  state          String?
  locationName   String?
  address        String?
  ticketsSold    Int          @default(0)
  revenue        Float        @default(0)
  createdAt      DateTime     @default(now())
  updatedAt      DateTime     @updatedAt
  organization   Organization @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  tickets        Ticket[]

  @@unique([organizationId, slug])
  @@index([organizationId])
  @@index([startsAt])
}

model Ticket {
  id            String   @id @default(cuid())
  eventId       String
  name          String
  description   String?
  price         Float
  currency      String   @default("BRL")
  quantityTotal Int
  quantitySold  Int      @default(0)
  isActive      Boolean  @default(true)
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  event         Event    @relation(fields: [eventId], references: [id], onDelete: Cascade)

  @@index([eventId])
}

model PlatformAuditLog {
  id          String   @id @default(cuid())
  actorUserId String
  action      String
  targetType  String
  targetId    String
  metadata    Json?
  createdAt   DateTime @default(now())

  @@index([actorUserId])
  @@index([targetId])
}

model WebhookLog {
  id             String   @id @default(cuid())
  organizationId String?
  provider       String
  status         String
  endpoint       String
  payload        Json?
  response       Json?
  attempts       Int      @default(1)
  lastError      String?
  createdAt      DateTime @default(now())

  @@index([organizationId])
}

model ScheduleSector {
  id                String                 @id @default(cuid())
  organizationId    String
  name              String
  isActive          Boolean                @default(true)
  minStaffByWeekday Json?
  maxStaffByWeekday Json?
  createdAt         DateTime               @default(now())
  updatedAt         DateTime               @updatedAt
  numberOfShifts    Int                    @default(1)
  employees         ScheduleEmployee[]
  organization      Organization           @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  sectorOutputs     ScheduleSectorOutput[]

  @@index([organizationId])
}

model ScheduleEmployee {
  id                       String         @id @default(cuid())
  organizationId           String
  sectorId                 String
  name                     String
  scheduleType             String?
  extraDaysOffPerMonth     Int?
  workDaysPerWeek          Int
  extraDaysOffDefault      Int
  extraDaysOffOverride     Int?
  weeklyOffPreferenceMain  Json?
  weeklyOffPreferenceExtra Json?
  unavailableWeekdays      Json?
  fixedOffDates            Json?
  fixedWorkDates           Json?
  maxConsecutiveWorkDays   Int?
  priorityScore            Int            @default(0)
  createdAt                DateTime       @default(now())
  updatedAt                DateTime       @updatedAt
  shift                    String?
  sector                   ScheduleSector @relation(fields: [sectorId], references: [id], onDelete: Cascade)

  @@index([organizationId])
  @@index([sectorId])
}

model ScheduleMonthConfig {
  id                         String   @id @default(cuid())
  organizationId             String
  year                       Int
  month                      Int
  teamExtraDaysOff           Int      @default(1)
  maxExtraOffPerDayOrg       Int?
  maxExtraOffPerDayPerSector Int?
  blockedDates               Json?
  preferredExtraOffDates     Json?
  createdById                String
  createdAt                  DateTime @default(now())
  updatedAt                  DateTime @updatedAt

  @@unique([organizationId, year, month])
}

model Schedule {
  id             String                 @id @default(cuid())
  organizationId String
  year           Int
  month          Int
  status         String
  createdById    String
  createdAt      DateTime               @default(now())
  updatedAt      DateTime               @updatedAt
  changes        ScheduleChange[]
  sectorOutputs  ScheduleSectorOutput[]

  @@unique([organizationId, year, month])
}

model ScheduleSectorOutput {
  id            String         @id @default(cuid())
  scheduleId    String
  sectorId      String
  data          Json
  coverageByDay Json
  warnings      Json
  createdAt     DateTime       @default(now())
  updatedAt     DateTime       @updatedAt
  schedule      Schedule       @relation(fields: [scheduleId], references: [id], onDelete: Cascade)
  sector        ScheduleSector @relation(fields: [sectorId], references: [id], onDelete: Cascade)

  @@unique([scheduleId, sectorId])
}

model ScheduleChange {
  id           String   @id @default(cuid())
  scheduleId   String
  userId       String
  targetUserId String
  day          Int
  oldValue     String
  newValue     String
  reason       String?
  createdAt    DateTime @default(now())
  schedule     Schedule @relation(fields: [scheduleId], references: [id], onDelete: Cascade)

  @@index([scheduleId])
}

model MenuCategory {
  id                String     @id @default(cuid())
  costCenterId      String
  organizationId    String?
  name              String
  sortOrder         Int        @default(0)
  isActive          Boolean    @default(true)
  activeForSalao    Boolean    @default(true)
  activeForRetirada Boolean    @default(true)
  activeForDelivery Boolean    @default(true)
  createdAt         DateTime   @default(now())
  updatedAt         DateTime   @updatedAt
  costCenter        CostCenter @relation(fields: [costCenterId], references: [id], onDelete: Cascade)
  items             MenuItem[]

  @@index([costCenterId])
  @@index([sortOrder])
}

model MenuItem {
  id                String            @id @default(cuid())
  menuCategoryId    String
  name              String
  description       String?
  imageUrl          String?
  type              MenuItemType      @default(SIMPLE)
  price             Float             @default(0)
  isActive          Boolean           @default(true)
  isFeatured        Boolean           @default(false)
  displayInPdv      Boolean           @default(true)
  activeForSalao    Boolean           @default(true)
  activeForRetirada Boolean           @default(true)
  activeForDelivery Boolean           @default(true)
  recipeId          String?
  costSnapshot      Float?
  markupPercent     Float?
  taxPercent        Float?
  internalNotes     String?
  createdAt         DateTime          @default(now())
  updatedAt         DateTime          @updatedAt
  menuCategory      MenuCategory      @relation(fields: [menuCategoryId], references: [id], onDelete: Cascade)
  recipe            Recipe?           @relation(fields: [recipeId], references: [id])
  usedInCombos      MenuItemCombo[]   @relation("ComboChild")
  comboItems        MenuItemCombo[]   @relation("ComboParent")
  optionGroups      MenuOptionGroup[]

  @@index([menuCategoryId])
  @@index([name])
}

model MenuItemCombo {
  id            String   @id @default(cuid())
  menuItemId    String
  childItemId   String
  quantity      Int      @default(1)
  canSubstitute Boolean  @default(false)
  childItem     MenuItem @relation("ComboChild", fields: [childItemId], references: [id], onDelete: Cascade)
  menuItem      MenuItem @relation("ComboParent", fields: [menuItemId], references: [id], onDelete: Cascade)

  @@index([menuItemId])
}

model MenuOptionGroup {
  id            String              @id @default(cuid())
  menuItemId    String
  name          String
  selectionType OptionSelectionType @default(SINGLE)
  isRequired    Boolean             @default(false)
  minOptions    Int                 @default(0)
  maxOptions    Int                 @default(1)
  sortOrder     Int                 @default(0)
  options       MenuOption[]
  menuItem      MenuItem            @relation(fields: [menuItemId], references: [id], onDelete: Cascade)

  @@index([menuItemId])
}

model MenuOption {
  id            String          @id @default(cuid())
  optionGroupId String
  name          String
  price         Float           @default(0)
  sortOrder     Int             @default(0)
  isActive      Boolean         @default(true)
  optionGroup   MenuOptionGroup @relation(fields: [optionGroupId], references: [id], onDelete: Cascade)

  @@index([optionGroupId])
}

enum UserRole {
  SUPER_ADMIN
  ADMIN
  MANAGER
  STAFF
  VIEWER
  DIRETOR
  ESTOQUE
  CHEF_DE_COZINHA
  LIDER_DESPACHO
}

enum UserScope {
  ORG
  RESTAURANTS
}

enum IntegrationPlatform {
  IFOOD
  RAPPI
  UBER_EATS
  LINX
  TOTVS
  STONE
  BLING
  TINY
  CUSTOM_API
  FOODY
  SAIPOS
  AGILIZONE
  NEEMO
  ANOTAAI
  CONSUMER
  CARDAPIO_WEB
  FOOD99
}

enum IntegrationStatus {
  CONFIGURED
  CONNECTED
  INGESTING
  DEGRADED
  STOPPED
}

enum SyncType {
  FULL
  INCREMENTAL
  WEBHOOK
  MANUAL
}

enum SyncStatus {
  PENDING
  RUNNING
  SUCCESS
  PARTIAL
  FAILED
}

enum InboxStatus {
  PENDING
  PROCESSED
  FAILED
  IGNORED
}

enum UnitType {
  WEIGHT
  VOLUME
  UNIT
  LENGTH
}

enum MovementType {
  IN
  OUT
  ADJUSTMENT
  TRANSFER
  WASTE
  PRODUCTION
  RETURN
}

enum MovementReferenceType {
  PURCHASE
  SALE
  RECIPE
  ADJUSTMENT
  PORTIONING
  TRANSFER
  WASTE
  INVENTORY
  INTEGRATION
}

enum RecipeType {
  TRANSFORMED_ITEM
  PORTIONING
  FINAL_PRODUCT
  COMBO
}

enum RecipeStatus {
  DRAFT
  INCOMPLETE
  COMPLETE
}

enum IngredientType {
  PRODUCT
  RECIPE
}

enum SalesChannel {
  DINE_IN
  TAKEOUT
  DELIVERY_OWN
  DELIVERY_IFOOD
  DELIVERY_RAPPI
  DELIVERY_UBER
}

enum ABCClassification {
  A
  B
  C
}

enum MatrixClassification {
  STAR
  CASH_COW
  PUZZLE
  DOG
}

enum RecommendedAction {
  MAINTAIN
  PROMOTE
  REPRICE
  REFORMULATE
  REMOVE
  INVESTIGATE
}

enum AlertType {
  STOCK_LOW
  STOCK_EXPIRING
  CMV_HIGH
  COST_INCREASE
  MARGIN_NEGATIVE
  YIELD_LOW
  INTEGRATION_ERROR
  ANOMALY_DETECTED
  GOAL_ACHIEVED
  GOAL_NEAR
}

enum AlertSeverity {
  LOW
  MEDIUM
  HIGH
  CRITICAL
}

enum NotificationChannel {
  IN_APP
  EMAIL
  WHATSAPP
  PUSH
}

enum SuggestionPriority {
  LOW
  MEDIUM
  HIGH
  URGENT
}

enum AnomalyType {
  CONSUMPTION_HIGH
  CONSUMPTION_LOW
  WASTE_HIGH
  PATTERN_UNUSUAL
  STOCK_DISCREPANCY
}

enum GoalType {
  REVENUE
  ORDER_COUNT
  AVG_TICKET
  CMV_PERCENT
  ITEMS_SOLD
  SPECIFIC_PRODUCT
  WASTE_REDUCTION
  STOCK_ACCURACY
}

enum IndicatorCycle {
  DAILY
  WEEKLY
  MONTHLY
  QUARTERLY
  CUSTOM
}

enum BadgeCategory {
  SALES
  QUALITY
  CONSISTENCY
  TEAMWORK
  MILESTONE
}

enum AuditAction {
  CREATE
  UPDATE
  DELETE
  LOGIN
  LOGOUT
  EXPORT
  IMPORT
}

enum InventoryStatus {
  OPEN
  COMPLETED
  CANCELLED
}

enum StockRequestStatus {
  PENDING
  APPROVED
  REJECTED
}

enum WorkShift {
  DAY
  NIGHT
}

enum PdvOrderType {
  DELIVERY
  RETIRADA
  SALAO
}

enum PdvOrderStatus {
  NOVO
  EM_PREPARO
  PRONTO
  EM_ENTREGA
  CONCLUIDO
  CANCELADO
}

enum PdvSalesChannel {
  PRESENCIAL
  SITE
  WHATSAPP
  IFOOD
  RAPPI
  UBER_EATS
  APP_PROPRIO
}

enum PaymentMethod {
  DINHEIRO
  CARTAO_CREDITO
  CARTAO_DEBITO
  PIX
  VALE_REFEICAO
  VALE_ALIMENTACAO
  CORTESIA
}

enum CashMovementType {
  VENDA
  SANGRIA
  SUPRIMENTO
  AJUSTE
}

enum TableStatus {
  LIVRE
  OCUPADA
  RESERVADA
}

enum PaymentStatus {
  PENDENTE
  PAGO
  ESTORNADO
}

enum CashSessionStatus {
  ABERTO
  FECHADO
}

enum PurchaseFilterMode {
  ALL
  SUPPLIER
  CATEGORY
}

enum PurchaseListTriggerType {
  MANUAL
  POS_INVENTARIO
  ESTOQUE_CRITICO
  DATA_FIXA
}

enum PurchaseListStatus {
  ABERTA
  EM_ANDAMENTO
  CONCLUIDA
  CANCELADA
}

enum PurchaseListItemStatus {
  PENDENTE
  CHEGOU
  PARCIAL
  CANCELADO
}

enum RecurrenceType {
  NENHUM
  SEMANAL
  MENSAL
}

enum EventStatus {
  DRAFT
  PUBLISHED
  CANCELLED
  ENDED
}

enum MenuItemType {
  SIMPLE
  COMBO
}

enum OptionSelectionType {
  SINGLE
  MULTIPLE
}

model Revenue {
  id              String   @id @default(cuid())
  costCenterId    String
  startDate       DateTime @db.Date
  endDate         DateTime @db.Date
  totalAmount     Float
  createdByUserId String
  notes           String?
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  costCenter      CostCenter @relation(fields: [costCenterId], references: [id], onDelete: Cascade)
  createdByUser   User       @relation("RevenueCreator", fields: [createdByUserId], references: [id])

  @@index([costCenterId, startDate, endDate])
  @@map("revenues")
}
